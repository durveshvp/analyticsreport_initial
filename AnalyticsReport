
import React, { Component } from 'react';
import { Container, Row, Col, Card, Form, Tabs, Tab, Alert } from "react-bootstrap";
import { DatePicker } from 'antd';
import 'antd/dist/antd.css';
import axios from 'axios';
import Loader from "./LoaderModal";
import ErrorAlert from './ErrorAlert';
import C from '../lib/Config';
import moment from 'moment';

const dateFormat = 'DD/MM/yyyy';

class AnalyticsReport extends Component {
    constructor(props) {
        super(props);
        this.state = {
            patientId: props.patientId,
            patientDetails: {},
            activeTreatmentPlans: [],
            followUpAppointments: null,
            previousChemoDetails: [],
            generatedSchedules: {},
            loaderModal: false,
            key: 'summary',
            error: null,
        };

        this.setKey = this.setKey.bind(this);
        this.getPatientDetails = this.getPatientDetails.bind(this);
        this.fetchFollowUpAppointments = this.fetchFollowUpAppointments.bind(this);
        this.fetchChemoDetails = this.fetchChemoDetails.bind(this);
    }

    componentDidMount() {
        const { patientId } = this.props;
        if (patientId) {
            this.setState({ patientId, loaderModal: true });
            this.getPatientDetails(patientId);
            this.getActiveTreatmentPlans(patientId);
            this.fetchFollowUpAppointments(patientId);
            this.fetchChemoDetails(patientId);
            this.fetchAdverseEffects(patientId);  // Fetch adverse effects
        }
    }

    componentDidUpdate(prevProps) {
        if (prevProps.patientId !== this.props.patientId) {
            this.setState({ patientId: this.props.patientId, loaderModal: true });
            this.getPatientDetails(this.props.patientId);
            this.getActiveTreatmentPlans(this.props.patientId);
            this.fetchFollowUpAppointments(this.props.patientId);
            this.fetchChemoDetails(this.props.patientId);
            this.fetchAdverseEffects(this.props.patientId);  // Fetch adverse effects
        }
    }

    getPatientDetails(patientId) {
        return fetch(C.getUrl() + `/analytics/getreport?patientid=${patientId}`)
            .then(response => response.json())
            .then(data => {
                this.setState({
                    patientDetails: data,
                    patientAge: this.getPatientAge(data.dob),
                    loaderModal: false,
                });
            })
            .catch(error => {
                this.setState({ error, loaderModal: false });
            });
    }

    getPatientAge(dob) {
        let birthDate = new Date(dob);
        let otherDate = new Date();
        let years = (otherDate.getFullYear() - birthDate.getFullYear());
        if (otherDate.getMonth() < birthDate.getMonth() ||
            (otherDate.getMonth() === birthDate.getMonth() && otherDate.getDate() < birthDate.getDate())) {
            years--;
        }
        return years;
    }

    // getActiveTreatmentPlans(patientId) {
    //     return fetch(C.getUrl() + `/userCase/getTreatmentPlanDetails?patientId=${patientId}`)
    //         .then(res => res.json())
    //         .then(res => {
    //             let resObj = JSON.parse(res.message);
    //             this.setState({ activeTreatmentPlans: resObj.patientTreatmentPlanDTOList || [], loaderModal: false });
    //         })
    //         .catch(err => {
    //             console.log("Error : " + err);
    //             this.setState({ error: true, loaderModal: false });
    //         });
    // }
    getActiveTreatmentPlans(patientId) {
        return fetch(C.getUrl() + `/userCase/getTreatmentPlanDetails?patientId=${patientId}`)
            .then(res => res.json())
            .then(res => {
                let resObj = JSON.parse(res.message);
                let activeTreatmentPlans = resObj.patientTreatmentPlanDTOList || [];
                
                let generatedSchedules = {};
                activeTreatmentPlans.forEach(plan => {
                    if (plan.scheduleMstDTO.scheduleDays && plan.chemoStartDt && plan.cyclesPlanned) {
                        generatedSchedules[plan.patientTreatmentPlanId] = this.generateSchedule(
                            plan.scheduleMstDTO.scheduleDays, 
                            plan.chemoStartDt, 
                            plan.cyclesPlanned
                        );
                    }
                });
                
                this.setState({ activeTreatmentPlans, generatedSchedules, loaderModal: false });
            })
            .catch(err => {
                console.log("Error : " + err);
                this.setState({ error: true, loaderModal: false });
            });
    }
    
    fetchFollowUpAppointments(patientId) {
        fetch(`${C.getUrl()}/followupAppt/findAll/${patientId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('');
                }
                return response.json();
            })
            .then(data => {
                if (data.message) {
                    const message = JSON.parse(data.message);
                    const followUpAppointments = message.followUpAppointments.map(appointment => {
                        let adverseEffects = '';
                        if (appointment.followupAdverseEffectDTOList && appointment.followupAdverseEffectDTOList.length !== 0) {
                            adverseEffects = appointment.followupAdverseEffectDTOList.map(effect => effect.reportParameterMstDTO.reportParamName).join(', ');
                        }
                        return {
                            ...appointment,
                            adverseEffects
                        };
                    });
                    this.setState({ followUpAppointments, error: null });
                } else {
                    this.setState({ followUpAppointments: [] });
                }
            })
            .catch(error => {
                console.error('Error fetching follow-up appointments:', error.message);
                this.setState({ followUpAppointments: [] });
            });
    }
    
    renderFollowUpAppointments() {
        const { followUpAppointments, error } = this.state;
    
        if (error) {
            return <div>Error: {error}</div>;
        }
    
        if (!followUpAppointments || followUpAppointments.length === 0) {
            return <div></div>;
        }
    
        return followUpAppointments.map(appointment => (
            <React.Fragment key={appointment.appointmentId}>
                <Row className="mb-3">
                    <Col lg="4">
                        <Form.Group className="mb-0">
                            <Form.Label><strong>Appointment Date</strong></Form.Label>
                            <Form.Control
                                type="text"
                                className="readOnlyView"
                                value={moment(appointment.appointmentDt).format('YYYY-MM-DD')}
                                disabled
                            />
                        </Form.Group>
                    </Col>
                    <Col lg="4">
                        <Form.Group className="mb-0">
                            <Form.Label><strong>Weight</strong></Form.Label>
                            <Form.Control
                                type="text"
                                className="readOnlyView"
                                value={`${appointment.weight || ''} ${appointment.weightUnitDto ? appointment.weightUnitDto.unitName : ''}`}
                                disabled
                            />
                        </Form.Group>
                    </Col>
                    <Col lg="4">
                        <Form.Group className="mb-0">
                            <Form.Label><strong>Adverse Effects</strong></Form.Label>
                            <Form.Control
                                type="text"
                                className="readOnlyView"
                                value={appointment.adverseEffects || ''}
                                disabled
                            />
                        </Form.Group>
                    </Col>
                </Row>
        
                <Row className="mb-3">
                    <Col lg="6">
                        <Form.Group className="mb-0">
                            <Form.Label><strong>Doctor Observation</strong></Form.Label>
                            <Form.Control
                                type="text"
                                className="readOnlyView"
                                value={appointment.doctorObservation || ''}
                                disabled
                            />
                        </Form.Group>
                    </Col>
                    <Col lg="6">
                        <Form.Group className="mb-0">
                            <Form.Label><strong>Doctor Prescription</strong></Form.Label>
                            <Form.Control
                                type="text"
                                className="readOnlyView"
                                value={appointment.doctorPrescription || ''}
                                disabled
                            />
                        </Form.Group>
                    </Col>
                </Row>
                <div className="dropdown-divider pb-2"></div>
            </React.Fragment>
        ));
    }                     
    
    fetchChemoDetails(patientId) {
        fetch(`${C.getUrl()}/userCase/getAllChemoSitting/${patientId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('No record found.');
                }
                return response.json();
            })
            .then(data => {
                if (data.statusCode === 200 && data.message !== 'No record found.') {
                    this.setState({ previousChemoDetails: JSON.parse(data.message) });
                } else {
                    this.setState({ previousChemoDetails: [] });
                }
            })
            .catch(error => {
                console.error('Error fetching chemo details:', error.message);
                this.setState({ previousChemoDetails: [] });
            });
    }
    
  renderChemoDetails() {
    const { previousChemoDetails } = this.state;
    const dateFormat = 'DD/MM/yyyy';

    // if (previousChemoDetails.length === 0) {
    //     return (
    //         <div>No previous chemotherapy sittings available.</div>
    //     );
    // }

    return previousChemoDetails.map((chemo, index) => (
        <div key={index} className="mb-3">
           
                Sitting - {moment(chemo.chemoDt).format(dateFormat)}
           
            
                <Row>
                    <Col sm="4">
                        <strong>Chemo Sitting Date:</strong> {moment(chemo.chemoDt).format(dateFormat)}
                    </Col>
                    <Col sm="4">
                        <strong>Delay in this Cycle:</strong> {chemo.delay === 'Y' ? 'Yes' : 'No'}
                    </Col>
                    <Col sm="4">
                        <strong>Treatment Given:</strong> {chemo.treatmentGiven || 'No details available'}
                    </Col>
                </Row>
            
        </div>
    ));
}

    
    setKey(key) {
        this.setState({ key });
    }

    formatDateMMDDYY(date) {
        if (date) {
            return (new Date(date)).toISOString().split('T')[0];
        }
        return "";
    }
//chemo shedule
addDays(forDate, days) {
    var newDate = new Date(forDate.getTime() + (days * 86400000));
    return newDate;
}
generateSchedule(scheduleDays, chemoStartDt, cyclesPlanned) {
    let generatedScheduledArr = [];
    let nextChemoDate = new Date(chemoStartDt);
    
    for (let x = 1; x <= cyclesPlanned; x++) {
        let data = {
            scheduleNum: x,
            scheduledDate: nextChemoDate
        };
        generatedScheduledArr.push(data);
        nextChemoDate = this.addDays(nextChemoDate, scheduleDays);
    }
    
    return generatedScheduledArr;
}
renderGeneratedSchedule(treatmentPlanId) {
    const { generatedSchedules } = this.state;

    if (!generatedSchedules[treatmentPlanId] || generatedSchedules[treatmentPlanId].length === 0) {
        return <div>No chemotherapy schedule available.</div>;
    }

    return (
        <table className="table table-striped table-hover text-center">
            <thead className="thead-light">
                <tr>
                    <th>#</th>
                    <th>Schedule Date</th>
                </tr>
            </thead>
            <tbody>
                {generatedSchedules[treatmentPlanId].map((schedule, idx) => (
                    <tr key={idx}>
                        <td>{schedule.scheduleNum}</td>
                        <td>{moment(schedule.scheduledDate).format('DD/MM/yyyy')}</td>
                    </tr>
                ))}
            </tbody>
        </table>
    );
}
mapIntent(intent) {
    if (intent === 'C') {
        return 'Curative';
    } else if (intent === 'P') {
        return 'Palliative';
    } else {
        return intent; // fallback in case of unexpected value
    }
}
mapBrainMets(brainMets) {
    if (brainMets === 'Y') {
        return 'Yes';
    } else if (brainMets === 'N') {
        return 'No';
    } else {
        return brainMets; // fallback in case of unexpected value
    }
}
mapBoneMetasis(boneMetasis) {
    if (boneMetasis === 'Y') {
        return 'Yes';
    } else if (boneMetasis === 'N') {
        return 'No';
    } else {
        return boneMetasis; // fallback in case of unexpected value
    }
}
fetchAdverseEffects(patientId) {
    fetch(C.getUrl() + `/followupAppt/findAll/${patientId}`)
        .then(response => response.json())
        .then(data => {
            if (data.message) {
                const message = JSON.parse(data.message);
                const adverseEffects = message.followupAdverseEffectDTOList.map(effect => {
                    return {
                        name: effect.reportParameterMstDTO.reportParamName,
                        desc: effect.reportParameterMstDTO.reportParamDesc,
                    };
                });
                this.setState({ adverseEffects });
            } else {
                this.setState({ adverseEffects: [] });
            }
        })
        .catch(error => {
            console.error('Error fetching adverse effects:', error);
            this.setState({ adverseEffects: [] });
        });
}

renderAdverseEffects() {
    const { adverseEffects } = this.state;

    if (!adverseEffects || adverseEffects.length === 0) {
        return <div></div>;
    }

    return adverseEffects.map((effect, index) => (
        <div key={index} className="mb-2">
           {effect.name}
        </div>
    ));
}
render() {
    const { key, patientDetails, activeTreatmentPlans, followUpAppointments, error, loaderModal } = this.state;

    if (loaderModal) {
        return <Loader />;
    }
    return (
        <div className="d-flex" id="wrapper">
            <div id="content-wrapper" className="d-flex flex-column">
                <div id="content">
                    <Container fluid>
                        <div className="app-content">
                            <section className="section" id="accordion">
                                <div className="form formBackground">
                                    
                                <Card className="custom-card mb-4">
                                        <Card.Header className="fixed-header"><b>Case Summary</b></Card.Header>
                                        <Card.Body className="">
                                            <Container fluid className="p-0 mt-4">
                                                <Row>
                                                    <Col lg="4" className="form-inline">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Case No.</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.caseId || ''}
                                                                name="caseNo"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg="3" className="form-inline">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Patient Name</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={`${patientDetails.firstName || ''} ${patientDetails.lastName || ''}`}
                                                                name="firstName"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg="3" className="form-inline">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Age</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={`${this.getPatientAge(patientDetails.dob)} Years`}
                                                                name="age"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg="3" className="form-inline">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Gender</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.genderName || ''}
                                                                name="gender"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                </Row>
                                                <div className="dropdown-divider pb-2"></div>
                                                <Row>
                                                    <Col lg="4">
                                                        <Form.Group>
                                                            <Form.Label>Date Of Birth</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={moment(patientDetails.dob).format('YYYY-MM-DD') || ''}
                                                                name="dob"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg="4">
                                                        <Form.Group>
                                                            <Form.Label>Email address</Form.Label>
                                                            <Form.Control
                                                                type="email"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.emailId || ''}
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg="4">
                                                        <Form.Group>
                                                            <Form.Label>Contact No.</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.phoneNumber1 || ''}
                                                                name="phoneNumber1"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg="4">
                                                        <Form.Group>
                                                            <Form.Label>Height</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.height || ''}
                                                                name="height"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg="4">
                                                        <Form.Group>
                                                            <Form.Label>Any ongoing treatment</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.ongoingTreatment || ''}
                                                                name="ongoingTreatment"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg="4">
                                                        <Form.Group>
                                                            <Form.Label>Other Allergies</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.allergies || ''}
                                                                name="allergies"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg="4">
                                                        <Form.Group>
                                                            <Form.Label>Comorbidities</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.comorbiditiesName || ''}
                                                                name="comorbidities"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg="4">
                                                        <Form.Group>
                                                            <Form.Label>Other Comorbidities</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.otherComorbidities || ''}
                                                                name="otherComorbidities"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                </Row>
                                            </Container>
                                        </Card.Body>
                                    </Card>
                                    <Card className="custom-card">
                                        <Card.Header className="fixed-header"><b>Initial Assessment</b></Card.Header>
                                        <Card.Body className="">
                                            <Container fluid className="p-0 mt-4">
                                                <Row>
                                                    <Col lg="4">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Initial Assessment Date</Form.Label>
                                                            <DatePicker value={patientDetails.patientIniAssessmentDt ? moment(patientDetails.patientIniAssessmentDt) : null} format={dateFormat} disabled className="form-control full-width25" />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg="4">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Pathology</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.pathologyName || ''}
                                                                name="pathologyName"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg="4">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Cancer stage</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.stageId || ''}
                                                                name="stageId"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <div className="w-100 my-3"></div>
                                                    <Col lg="4">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Bone Metasis</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.boneMetasis === 'Y' ? 'Yes' : patientDetails.boneMetasis === 'N' ? 'No' : patientDetails.boneMetasis || ''}
                                                                name="boneMetasis"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg="4">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Brain Mets</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.brainMets === 'Y' ? 'Yes' : patientDetails.brainMets === 'N' ? 'No' : patientDetails.brainMets || ''}
                                                                name="brainMets"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg="4">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Limb Loss</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.limbLossName || ''}
                                                                name="limbLossName"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <div className="w-100 my-3"></div>
                                                    <Col lg="4">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Mutation</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.mutationName || ''}
                                                                name="mutationName"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg="4">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Previous Cancer History</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.cancerSiteName || ''}
                                                                name="cancerSiteName"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg="4">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Doctor Observation</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.doctorObservation || ''}
                                                                name="doctorObservation"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <div className="w-100 my-3"></div>
                                                    <Col lg="4">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Doctor Prescription</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.doctorPrescription || ''}
                                                                name="doctorPrescription"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                </Row>
                                            </Container>
                                        </Card.Body>
                                    </Card>
                                    <Card className="custom-card">
                                        <Card.Header className="fixed-header"><b>Treatment Plan</b></Card.Header>
                                        <Card.Body className="">
                                            <Container fluid className="p-0 mt-4">
                                                <Row>
                                                    <Col lg="4">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Treatment Plan Date</Form.Label>
                                                            <DatePicker value={patientDetails.creationDate ? moment(patientDetails.creationDate) : null} format={dateFormat} disabled className="form-control full-width25" />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg="4">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Intent</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.intent === 'C' ? 'Curative' : patientDetails.intent === 'P' ? 'Palliative' : patientDetails.intent || ''}
                                                                name="Intent"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg="4">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Rx Modification Date</Form.Label>
                                                            <DatePicker value={patientDetails.chemoStartDt ? moment(patientDetails.chemoStartDt) : null} format={dateFormat} disabled className="form-control full-width25" />
                                                        </Form.Group>
                                                    </Col>
                                                    <div className="w-100 my-3"></div>
                                                    <Col lg="4">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Regimen Planned (Protocol Title)</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.protocolName || ''}
                                                                name="protocolName"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg="4">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Chemotherapy Phase/ Regimen Due</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.chemoPhaseRegimen || ''}
                                                                name="chemoPhaseRegimen"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg="4">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Schedule for Doctor's Visit</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.scheduleName || ''}
                                                                name="scheduleName"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <div className="w-100 my-3"></div>
                                                    <Col lg="4">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Cycles Planned</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.cyclesPlanned || ''}
                                                                name="cyclesPlanned"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg="4">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">1st Chemo Cycle</Form.Label>
                                                            <DatePicker value={patientDetails.appointmentDt ? moment(patientDetails.appointmentDt) : null} format={dateFormat} disabled className="form-control full-width25" />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg="4">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Plan of Treatment</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.treatmentPlan || ''}
                                                                name="treatmentPlan"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <div className="w-100 my-3"></div>
                                                    <Col lg="4">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Consent waive Off comment:</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.waiveOffConsent || ''}
                                                                name="waiveOffConsent"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg="4">
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Dosage Frequency</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.scheduleName || ''}
                                                                name="scheduleName"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                </Row>
                                            </Container>
                                        </Card.Body>
                                    </Card>
                                    <Card className="custom-card">
                                        <Card.Header className="fixed-header"><b>Active Treatments</b></Card.Header>
                                        <Card.Body className="">
                                            <Container fluid className="p-0 mt-4">
                                                <Row>
                                                    {activeTreatmentPlans.map((d, idx) => (
                                                        <Col lg="6" key={idx} className="mb-4">
                                                            <Card className="custom-card">
                                                                <Card.Header className="fixed-header"><b>Active Treatment Plan</b></Card.Header>
                                                                <Card.Body className="">
                                                                    <div className="product-details pl-3 ml-3">
                                                                        <p><label>Regimen Planned:</label> {d.protocolMstDTO.protocolName}</p>
                                                                        <p><label>Cycles Planned:</label> {d.cyclesPlanned}</p>
                                                                        <p><label>Schedule for Doctor's Visit:</label> {d.scheduleMstDTO.scheduleName}</p>
                                                                        <p><label>Chemo Date:</label> {this.formatDateMMDDYY(d.chemoStartDt)}</p>
                                                                    </div>
                                                                    <div className="mt-3">
                                                                        <h5>Chemotherapy Schedule</h5>
                                                                        {this.renderGeneratedSchedule(d.patientTreatmentPlanId)}
                                                                    </div>
                                                                </Card.Body>
                                                            </Card>
                                                        </Col>
                                                    ))}
                                                </Row>
                                            </Container>
                                        </Card.Body>
                                    </Card>
                                    <Card className="custom-card">
                                        <Card.Header className="fixed-header"><b>Follow-Up Appointment Dates</b></Card.Header>
                                        <Row className="ml-4 mb-3">
                                        <Col lg="3">
                                            <Form.Group className="mb-0">
                                                <Form.Label className="mr-3"><strong>Follow-Up Date</strong></Form.Label>
                                                {patientDetails.chemoDt ? (
                                                    <DatePicker 
                                                        value={moment(patientDetails.appointmentDt)} 
                                                        format={dateFormat} 
                                                        disabled={true} 
                                                        className="form-control full-width25" 
                                                    />
                                                ) : (
                                                    <Form.Control 
                                                        type="text" 
                                                        value="Date not available" 
                                                        disabled={true} 
                                                        className="form-control full-width25" 
                                                    />
                                                )}
                                            </Form.Group>
                                        </Col>
                                        <Col lg="3">
                                            <Form.Group className="mb-0">
                                                <Form.Label className="mr-3"><strong>Weight</strong></Form.Label>
                                                <Form.Control
                                                    type="text"
                                                    className="readOnlyView inline"
                                                    value={patientDetails.faWeight}
                                                    name="faWeight"
                                                    disabled
                                                />
                                            </Form.Group>
                                        </Col>
                                        <Col lg="6">
                                            <Form.Group className="mb-0">
                                                <Form.Label className="mr-3"><strong>Adverse Effects</strong></Form.Label>
                                                <div>{this.renderAdverseEffects()}</div>
                                            </Form.Group>
                                        </Col>
                                    </Row>

                                    <Row className="ml-4 mb-3">
                                        <Col lg="6">
                                            <Form.Group className="mb-0">
                                                <Form.Label className="mr-3"><strong>Doctor Observation</strong></Form.Label>
                                                <Form.Control
                                                    type="text"
                                                    className="readOnlyView inline"
                                                    value={patientDetails.faDoctorObservation}
                                                    name="faDoctorObservation"
                                                    disabled
                                                />
                                            </Form.Group>
                                        </Col>
                                        <Col lg="6">
                                            <Form.Group className="mb-0">
                                                <Form.Label className="mr-3"><strong>Doctor Prescription</strong></Form.Label>
                                                <Form.Control
                                                    type="text"
                                                    className="readOnlyView inline"
                                                    value={patientDetails.faDoctorPrescription}
                                                    name="faWeifaDoctorPrescriptionght"
                                                    disabled
                                                />
                                            </Form.Group>
                                        </Col>
                                    </Row>
                                        <Card.Body>
                                            <Container fluid className="p-0 mt-4">
                                                {followUpAppointments && followUpAppointments.map(appointment => (
                                                    <React.Fragment key={appointment.appointmentId}>
                                                        <Row className="ml-3.8 mb-3">
                                                            <Col lg="3">
                                                                <Form.Group className="mb-0">
                                                                    <Form.Label><strong>Appointment Date</strong></Form.Label>
                                                                    <Form.Control
                                                                        type="text"
                                                                        className="readOnlyView inline"
                                                                        value={moment(appointment.appointmentDt).format('YYYY-MM-DD')}
                                                                        disabled
                                                                    />
                                                                </Form.Group>
                                                            </Col>
                                                            <Col lg="2">
                                                                <Form.Group className="mb-0">
                                                                    <Form.Label><strong>Weight</strong></Form.Label>
                                                                    <Form.Control
                                                                        type="text"
                                                                        className="readOnlyView inline"
                                                                        value={`${appointment.weight || ''} ${appointment.weightUnitDto ? appointment.weightUnitDto.unitName : ''}`}
                                                                        disabled
                                                                    />
                                                                </Form.Group>
                                                            </Col>
                                                            <Col lg="7">
                                                                <Form.Group className="mb-0">
                                                                    <Form.Label><strong>Adverse Effects</strong></Form.Label>
                                                                    <Form.Control
                                                                        type="text"
                                                                        className="readOnlyView inline"
                                                                        value={appointment.adverseEffects || ''}
                                                                        disabled
                                                                    />
                                                                </Form.Group>
                                                            </Col>
                                                        </Row>

                                                        <Row className="ml-3 mb-3">
                                                            <Col lg="6">
                                                                <Form.Group className="mb-0">
                                                                    <Form.Label><strong>Doctor Observation</strong></Form.Label>
                                                                    <Form.Control
                                                                        type="text"
                                                                        className="readOnlyView inline"
                                                                        value={appointment.doctorObservation || ''}
                                                                        disabled
                                                                    />
                                                                </Form.Group>
                                                            </Col>
                                                            <Col lg="6">
                                                                <Form.Group className="mb-0">
                                                                    <Form.Label><strong>Doctor Prescription</strong></Form.Label>
                                                                    <Form.Control
                                                                        type="text"
                                                                        className="readOnlyView inline"
                                                                        value={appointment.doctorPrescription || ''}
                                                                        disabled
                                                                    />
                                                                </Form.Group>
                                                            </Col>
                                                        </Row>
                                                        <div className="dropdown-divider pb-2"></div>
                                                    </React.Fragment>
                                                ))}
                                            </Container>
                                        </Card.Body>
                                    </Card>
                                    <Card className="custom-card">
                                        <Card.Header className="fixed-header"><b>Previous Chemo Sitting</b></Card.Header>
                                        <Card.Body className="">
                                            <Container fluid className="p-0 mt-4">
                                                <Row>
                                                    <Col lg='4'>
                                                        <Form.Group>
                                                            <Form.Label>Date</Form.Label>
                                                            <DatePicker value={patientDetails.chemoDt ? moment(patientDetails.chemoDt) : ''} format={dateFormat} disabled={true} className="form-control full-width25" />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg='4'>
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Chemo Dosage Prescription</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.treatmentGiven || ''}
                                                                name="treatmentGiven"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg='4'>
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">Antiemetic Medication</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.antiemeticDrugs || ''}
                                                                name="antiemeticDrugs"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                    <Col lg='4'>
                                                        <Form.Group className="mb-0">
                                                            <Form.Label className="mr-3">GCSF Medication</Form.Label>
                                                            <Form.Control
                                                                type="text"
                                                                className="readOnlyView inline"
                                                                value={patientDetails.gcsfMed || ''}
                                                                name="gcsfMed"
                                                                disabled
                                                            />
                                                        </Form.Group>
                                                    </Col>
                                                </Row>
                                                <div className="dropdown-divider pb-2"></div>
                                                <Row>
                                                    {this.renderChemoDetails()}
                                                </Row>
                                            </Container>
                                        </Card.Body>
                                    </Card>
                                </div>
                            </section>
                        </div>
                    </Container>
                </div>
            </div>
            <Loader show={loaderModal} />
        </div>
    );
}

    }
    

export default AnalyticsReport;
